"use strict";import{Utils}from"../../../GoodFuncs.js/dist/GoodFuncs.js";export var QooizPlayer;!function(t){class e{constructor(t,i={}){this.uniq=Utils.GoodFuncs.getRandomString(12),this.styleFilePath=i.styleFilePath||e.defaultOptions.styleFilePath,this.activate=void 0!==i.activate?i.activate:e.defaultOptions.activate,this.mainWrapperClass=i.mainWrapperClass||e.defaultOptions.mainWrapperClass,this.imageWrapperClass=i.imageWrapperClass||e.defaultOptions.imageWrapperClass,this.scrollButtonsWidth=i.scrollButtonsWidth||e.defaultOptions.scrollButtonsWidth,this.scrollButtonsPadding=i.scrollButtonsPadding||e.defaultOptions.scrollButtonsPadding,this.imageStopClass=i.imageStopClass||e.defaultOptions.imageStopClass,t.classList.add("player"),t.insertAdjacentHTML("beforeend",`<div class="${this.mainWrapperClass}"></div>`),t.insertAdjacentHTML("beforeend",`<div class="${this.imageWrapperClass}"></div>`),this.imageWrapper=t.querySelector(this.imageWrapperClass),this.mainWrapper=t.querySelector(this.mainWrapperClass),this.imageWrapper.classList.add(this.uniq),t.querySelectorAll(`img:not(.${this.imageStopClass})`).forEach(function(t){this.addItem(t),t.remove()},this),t.classList.contains("video")?(this.render=function(t){return e.renderVideo(this.mainWrapper,t)}.bind(this),this.type="video"):t.classList.contains("image")?(this.render=function(t){return e.renderImage(this.mainWrapper,t)}.bind(this),this.type="image"):t.classList.contains("book")&&(this.render=function(t){return e.renderBook(this.mainWrapper,t)}.bind(this),this.type="book"),this.imageWrapper.addEventListener("click",function(t){let e=Utils.GoodFuncs.getDelegateTarget(t,".img");e&&this.render(e)}.bind(this)),this.imageWrapper.addEventListener("click",function(t){let e=Utils.GoodFuncs.getDelegateTarget(t,".img > i");e&&(this.deleteItem(Utils.GoodFuncs.index(e.parentElement,".img")),t.stopPropagation())}.bind(this));let s=this.imageWrapper.querySelector(".img");s.classList.add("first"),this.activate&&s.dispatchEvent(new Event("click"));let r="."+this.uniq,a=Utils.GoodFuncs.pseudo(this.styleFilePath,r+":before"),l=Utils.GoodFuncs.pseudo(this.styleFilePath,r+":after");this.imageWrapper.addEventListener("click",function(t){if(this.imageWrapper.getAttribute("disabled"))return;let e=t.detail&&t.detail.offset||t.offsetX;if(this.imageWrapper.scrollLeft<this.scrollButtonsPadding&&e<=this.scrollButtonsWidth||this.imageWrapper.scrollLeft>this.imageWrapper.scrollWidth-this.imageWrapper.clientWidth-this.scrollButtonsPadding&&e>=this.imageWrapper.clientWidth-this.scrollButtonsWidth)return!1;let i=this.imageWrapper.querySelector(".img");if(i.classList.remove("first"),e<=this.scrollButtonsWidth?Utils.GoodFuncs.prev(i,".img").classList.add("first"):e>=this.imageWrapper.clientWidth-this.scrollButtonsWidth&&Utils.GoodFuncs.next(i,".img").classList.add("first"),!(i=this.imageWrapper.querySelector(".img.first")))return;let s=0;Utils.GoodFuncs.prevAll(i,".img").forEach(function(t){s+=t.clientWidth}),this.imageWrapper.animate({scrollLeft:s},500),this.imageWrapper.removeAttribute("disabled"),a({left:s+"px !important"}),l({left:"calc(100% + "+s+"px) !important"})}.bind(this)),this.imageWrapper.addEventListener("wheel",function(t){this.getAttribute("disabled")||(t.deltaY<0?this.dispatchEvent(new CustomEvent("click",{detail:{offset:0}})):this.dispatchEvent(new CustomEvent("click",{detail:{offset:this.clientWidth}})))})}static renderVideo(t,e){if(e.classList.contains("current"))return null;let i=e.dataset.objectSrc,s=e.dataset.src;if(!i){let t=s?s.match(/^(.*?\/)image\/(\w+)/):null;i=Array.isArray(t)?t[1]+"video/"+t[2]+".mp4":null}if(!i)return null;t.querySelector("video:visible").style.display="none",Array.from(e.parentElement.children).forEach(function(t){t.classList.remove("current")}),e.classList.add("current");for(let e of Array.from(t.querySelectorAll("video")))if((e=e).src===i)return e.style.display="block",e;let r=Utils.GoodFuncs.createElementWithAttrs("video",{src:i,controls:"controls",poster:s,preload:"metadata",controlsList:"nodownload",text:"Видео не доступно",volume:"high",status:"stop",fullscreen:"no"});return t.insertAdjacentElement("afterbegin",r),r}static renderImage(t,e){if(e.classList.contains("current"))return null;t.querySelector("img:visible").style.display="none",Array.from(e.parentElement.children).forEach(function(t){t.classList.remove("current")}),e.classList.add("current");let i=e.dataset.src;for(let e of Array.from(t.querySelectorAll("img")))if(e.src===i)return e.style.display="block",e;let s=Utils.GoodFuncs.createElementWithAttrs("img",{class:"materialboxed",src:i});return t.insertAdjacentElement("afterbegin",s),s}static renderBook(t,e){if(e.classList.contains("current"))return null;let i=e.dataset.objectSrc,s=e.dataset.src,r=e.dataset.type||i.match(/.+?\.([^.]+)$/)[1];if(!i){let t=s?s.match(/^(.*?\/)image\/(\w+)/):null;i=Array.isArray(t)&&r?t[1]+"book/"+t[2]+"."+r:null}if(!i||!r)return null;t.querySelector("iframe:visible, embed:visible").style.display="none",Array.from(e.parentElement.children).forEach(function(t){t.classList.remove("current")}),e.classList.add("current");for(let e of Array.from(t.querySelectorAll("embed, iframe")))if(e.src===e)return e.style.display="block",e.tagName,e;let a=document.createElement("iframe");switch(r){case"pdf":a.setAttribute("src",i);break;default:a.setAttribute("src","https://docs.google.com/viewer?url="+document.location.origin+i+"&embedded=true")}t.insertAdjacentElement("afterbegin",a)}get id(){return this.uniq}addItem(t,e=!1,i=""){if(t.closest(".clone"))return;let s=Utils.GoodFuncs.createElementWithAttrs("span",{class:"img","data-src":t.src,title:t.title.length>50?t.title.substr(0,50)+"...":t.title,"data-object-src":t.dataset.objectSrc,"data-type":t.dataset.type,html:'<i class="material-icons">close</i>',"data-source":i||t.dataset.source});s.style.backgroundImage="url("+t.src+")",this.imageWrapper.appendChild(s),e&&s.dispatchEvent(new Event("click"))}deleteItem(t){let e=Array.from(this.imageWrapper.querySelectorAll(".img")),i=e[t],s=i.dataset.objectSrc;i.remove(),this.mainWrapper.querySelector('*[src="'+s+'"]').remove(),e[t+1].dispatchEvent(new Event("click")),this.imageWrapper.dispatchEvent(new CustomEvent("deleteItem",{detail:{index:t,image:i}}))}}e.defaultOptions={styleFilePath:"player.css",activate:!0,mainWrapperClass:"main-wrapper",imageWrapperClass:"image-wrapper",scrollButtonsWidth:50,scrollButtonsPadding:10,imageStopClass:"no-image"},t.Player=e}(QooizPlayer||(QooizPlayer={}));